#+TITLE: Regional Module Graphical User Interface (GUI) User Guide
#+AUTHOR:    Mohamad Elmasri
#+EMAIL:     elmasri.m@gmail.com

#+OPTIONS:   H:4 num:t toc:3 p:t ^:nil
#+STARTUP: nofold

# #+HTML_HEAD: <link rel="stylesheet" type="text/css" href="css/styles/readtheorg/css/htmlize.css"/>
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="css/styles/readtheorg/css/readtheorg.css"/>

#+HTML_HEAD: <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
#+HTML_HEAD: <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="css/styles/lib/js/jquery.stickytableheaders.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="css/styles/readtheorg/js/readtheorg.js"></script>


#+CAPTION: A Screen shot of RM_GUI
#+NAME:   fig:RM_GUI
[[./img/RM_GUI.png]]

This document explains how to use the software GUI of the Regional module. There are four main frames in the GUI that could be seen in Figure [[fig:RM_GUI]].
    - *General information*: General session and user information as the user name and database location.
    - *Importing questionnaire to the database: test*: tools needed to a single or a folder of questionnaires.
    - *Exporting data to Excel*: tools to export and visualize the data in the database.
    - *Status*: a panel that outputs updates on the carried procedures, including any errors.

#+begin_sidebar
In this guide you will learn to:
    + Import questionnaires.
    + Export and and view data.
    + Move data between series.
    + And hopefully some Python.
#+end_sidebar
Each frame has a specific subsection below that explains in details how to use the available tools.

* General information
This frame constitute of information that are essential for all the tool in other frames and will be used all over this guide.

    * *Username*
        The user name is automatically retrieved from the windows login information. 
    * *Main working directory*
      The location of the main folder where all the other mentioned subfolderes are located.
    * *Database*
        Variable ~Database~ shows the location of the database(~.db~ file), in Figure [[fig:RM_GUI]] the is located 
        in the main folder in subfolder ~Database~ in file ~UISProd.db~ as indicated by ~/Database/UISProd.db~. 
        For example if the main folder is ~/Desktop/RMS~ then the database file is at ~/Desktop/RMS/Database/UISProd~.   
    * *Log folder*
        Every time a user attempts to write, read or move data, a log file is created in the subfolder ~Log~ in the main folder. See Section [[Processing report]] for more details.
    * *Output folder*
       A default folder where exported Excel workbooks are save if no other folder is specified.
    * *Import backup folder*
       Every time a data is successfully imported through this [[fig:RM_GUI][GUI]] a copy of the data along with time and date stamps are saved to this folder.

#+begin_note
 * Data in the general information frame are only editable from the scripts, not from the GUI.
 * Only the Export folder is editable through the export panel.
#+end_note

* Importing questionnaire to the database
Two ways exist to importing questionnaires. 
    1) Importing a single questionnaire
       In this method click on ~Browse..~ button that is adjacent to ~file~ label, select a file and then click the adjacent ~import~ button.
    2) Importing a folder of questionnaires.
       Here click on ~Browse..~ that is adjacent to ~folder~ label, select a folder and then click on the adjacent ~import~ button.

Inf= both cases, each file is first validated with pre-precessing checks to make sure that it conforms with the coding scheme. Validation logs will appear in the [[Status]] frame and also a report is written in the ~Log folder~. 

For more detailed information about the pre-processing report please refer to [[Processing report]]

#+begin_note
    * Note that only files with ~.xlsx~ extensions are imported in both cases.
    * All imported files are copied to the ~Export~ subfolder with time and data stamps concatenated to their names to indicate the time of importing.
#+end_note

* Exporting data to Excel
** Choosing a country name, year and series
The ~Country~ drop-down list will only show the country names of with data already imported to  the database. This drop-down is directly connected to the database, and if one imports a questionnaire for a new country as shown in a [[Importing questionnaire to the database][previous section]], the new country name should appear in the drop-down list.

One a Country name is selected, the data year of all available data should be available in the ~Year~ drop-down list. Generally the ~Year~ drop-down list will show two consecutive years, since the questionnaire requests some data for a precedent year.

The series drop-down list has three options
    1. Reported (REP): where the original questionnaire is inserted. Given that no programme team has changed modified any of the data in this series, it should be the same as the original questionnaire.
    2. Observed (OBS): where the programme teams modify and validate the data.
    3. Estimated (EST): where the disseminated data set should be.

** Moving data between series
An orgininal questionnaire is always imported to the Reported series, to move it the Observed or Estimated series, choose first the country and year, and then click on the button in the ~Move between databses~ frame.

~REP to OBS~ would move the data of the selected country and year from Reported series to Observed series.

~OBS to EST~ would move the data of the selected country and year from the Observed series to Estimated series.

** Exporting options

#+begin_important
This section is important because is contains many necessary details to understand how the whole GUI works.
#+end_important

There are three ways to export the data, sheet only, table only and alphanumeric code only. 
    1. Sheet: a drop-down list of all exportable questionnaire sheet names. Once a sheet is selected click on the adjacent ~Export~ button to export it to a new Excel workbook. To export all available sheets select ~All~ from the drop-down list.
    2. Table: a drop-down list with all tables of the questionnaire. By selecting one and clicking on the adjacent ~Export~ button an new Excel workbook is created that hold the selected table.
    3. AC: a drop-down list with all alphanumeric codes (AC) that are in the questionnaire. By selecting one and clicking on the adjacent ~Export~ button a new Excel workbook is created that holds the data.

#+begin_note
The exported workbooks are by default saved to ~Export~ subfolder with
the naming convention ~County Name-Year-Exported Variable-Series.xlsx~. Users
can change where to save exported files by selecting a folder in the option
~Select output folder~ as seen in the ~Exporting data to Excel~ frame
in Figure [[fig:RM_GUI]]. 
#+end_note

Also there are two viewing modes, and ~Edit~ and a ~Read only~ mode. 
    1) ~Edit~ mode: allows users to edit the data, comments and inclusion in the excel sheet and re-import them to the database as shown in [[Importing questionnaire to the database][Importing questionnaire to the database]] section. This work by preserving the table location exactly where they are it the original questionnaire. Users will notice that the exported Excel using edit mode looks very similar to the original questionnaire. *DO NOT* move tables from their original location,  change the sheet name, or delete any of the data in the configuration panel in the top left corner as seen in Figure [[fig:exportConfig]]. You are only allowed to modify cell figures, comments and inclusions.
    2) ~Read only~ mode: facilitates the viewing of the data by shifting tables to the left part of the Excel worksheet to avoid any necessary scrolling. However, the mode will not allow users to re-import the data back in the database, since the tables or alphanumeric codes are not in the exact location as they are in the original questionnaire.

#+CAPTION: A Screen of the top left corner of an exported Excel sheet.
#+NAME:   fig:exportConfig
[[./img/exportConfig.png]]

#+begin_note
The viewing mode is chosen by the software. It is set to ~Edit~ mode if a sheet or the whole questionnaire is exported, otherwise it is set to ~Read only~ mode. Users can know the mode by looking at the top left corner of any exported Excel sheet as seen in Figure [[fig:exportConfig]].
#+end_note

* Status fame and Log subfolder
The ~Status~ frame is a read-only text box that outputs all progression signals and errors. Some of the outputs are also recorded in the ~Log~ subfolder. 

* Processing report
A pre-processing report is created every time one attempts to import a questionnaire. It includes all confirmations and errors and have the following naming convention ~Country Name-Year-Series-Data-Type-Time-Date.txt~. Some the data included in the report is also printed in the ~Status~ frame.

The idea of the processing report is to list errors and data problems exist before inserting the questionnaire. Only if all the data checks pass the questionnaire is imported.

* A complete example 
** Importing the original questionnaire
To give an example consider importing ~LAOS~ data for year ~2012~ that is saved in a file called ~LAOS-2012-RM.xlsx~. That is saved in the folder ~Desktop/Example~ as seen in Figure [[fig:laosDesktop]]. Let's first start the ~RM_GUI.py~ select the file and click import, which shows the following text in the ~Status~ label.

#+CAPTION: LAOS Original questionnaire submission.
#+NAME:   fig:laosDesktop
[[./img/LAOS_desktop.png]]

#+begin_src
Importing C:/Users/Mohamad/Desktop/Example/LAOS-2012-RM.xlsx
Date: 08/03/15
Questionnaire path: C:/Users/Mohamad/Desktop/Example/LAOS-2012-RM.xlsx
All the checks passes. QUESTIONNAIRE CAN BE PROCESSED
Import successful...Done
#+end_src

This implies the import is successfully.

** Moving to and exporting from the /Observed/(Clean) series.
After a successful original import, one can move the data from /Reported/ to /Observed/ series. First notice that the ~Country~ drop-down list included Laos to confirm it exists in the database. Select ~Laos~ and the corresponding year, then click on ~REP to OBS~ button. The ~Status~ frame looks like [[fig:laosREP2CLN][this]] now.

#+CAPTION: LAOS data moved from REP to OBS.
#+NAME:   fig:laosREP2CLN
[[./img/LASO_moveCLN.png]]

Now, let's export ~Teachers ISCED 2~ for cleaning. Select the country, year and series from the drop-down lists and from the ~Sheet~ drop-down list select ~Teachers ISCED 2~ and before clicking on the adjacent ~Export~ button, select the ~output folder~ to be your ~Desktop~.  The ~Status~ frame will have the confirmation seen in box [[src:export_clean]], and the Excel workbook should look like [[fig:excel_clean][this]]. Notice the configurations in the top left corner, where the mode is ~Edit~ and the series is ~OBS~. 

#+CAPTION: Status frame output
#+NAME:   src:export_clean
#+begin_src
Exporting Teachers ISCED 2 from OBS series for Lao People's Democratic Republic-2012....
File C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2012_Teachers ISCED 2_OBS.xlsx is created..
Done.
#+end_src   

#+CAPTION: Exported LAOS data from observed series.
#+NAME:   fig:export_clean
[[./img/export_clean.png]]

** Cleaning and re-importing
As mentioned before as long as the configuration panel is left
untouched and all tables are not moved, one can go ahead and change
the data, inclusion codes and insert cell and table comments. For
example, assume that Laos-2012 data reported under ~T.2.GPV.Pu.F~ in
col 3 is not trusted an we rather trust ~T.2.GPV.Pu~ in column 2 and
include ~T.2.GPV.Pu.F~ under it. Also we add a comment that the data
is not trusted. See Figure [[fig:laos_mod]] and compare it to Figure
[[fig:export_clean]].
#+CAPTION: Modified LAOS data from observed series.
#+NAME:   fig:laos_mod
[[./img/laos_mod.png]]


*To import* follow similar step as in Section [[Importing questionnaire
 to the database]]. Start ~RM_GUI~ select the modified file and import
 it. If successful the ~Status~ frame should show
#+begin_src
Importing C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2012_Teachers ISCED 2_OBS.xlsx
Import successful...Done
#+end_src
otherwise it would list validation errors such as.
#+begin_src
Pre-processing validation failed. Some erros exist see log file in:
Log
Importing C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2012_Teachers ISCED 2_OBS.xlsx
Column 14 in table Table 2.2 has improper values.
#+end_src

Now if you re-export the whole questionnaire, ~Teachers ISCED 2~
sheet, or only ~Table 2.1~ from the observed series, you should be
able to see the changes and comments.

Example, done.
