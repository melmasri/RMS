<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Regional Module Code Documentation</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Oscar Alberto Quijano Xacur and Mohamad Elmasri" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="css/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="css/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Regional Module Code Documentation</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Importing the Library</a></li>
<li><a href="#sec-2">2. Importing</a></li>
<li><a href="#sec-3">3. Preprocessing</a></li>
<li><a href="#sec-4">4. Data extraction and comments</a></li>
<li><a href="#sec-5">5. Exporting the data</a></li>
</ul>
</div>
</div>
<p>
This document explains how to process data for the RMS questionnaire
using python code instead of the GUI. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Importing the Library</h2>
<div class="outline-text-2" id="text-1">
<p>
First import the library <code>rmquestionnaire</code> in <code>RMS\Libraries</code>, a code example is below.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">RMS_folder</span>=<span style="color: #E6DB74;">"/home/oscar/RMS/"</span>
<span style="color: #F92672;">import</span> sys
sys.path.append(RMS_folder+<span style="color: #E6DB74;">"Libraries"</span>)
<span style="color: #F92672;">from</span> rmquestionnaire <span style="color: #F92672;">import</span> *
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Importing</h2>
<div class="outline-text-2" id="text-2">
<p>
In order to import data from a questionnaire the <code>questionnaire</code> class
should be used. Three arguments are needed when an object from this
class is defined: the excel file, the database file and the log folder.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">excel_file</span>=<span style="color: #E6DB74;">"Regional_Survey_2015.xlsx"</span>
<span style="color: #FD971F;">database_file</span>= RMS_folder + <span style="color: #E6DB74;">"Database/UISProd.db"</span>     <span style="color: #75715E;"># </span><span style="color: #75715E;">Concatenating the path of the main folder and the database subfolder.</span>
<span style="color: #FD971F;">log_folder</span>=<span style="color: #E6DB74;">"/tmp/log/"</span>            
<span style="color: #FD971F;">qobject</span>=questionnaire(excel_file,database_file,log_folder)
</pre>
</div>
<p>
By initiating the  <code>qobject</code> as shown above, the class reads the file to know if the questionnaire is being imported for the first time
or if it is an edited questionnaire and what Database type to use
i.e. OBS, REP or EST. Also, <code>questionnaire</code> checks that the country
name used in the file exist the database, otherwise, an error is raised.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Preprocessing</h2>
<div class="outline-text-2" id="text-3">
<p>
There is a <code>preprocessing</code> method. If the questionnaire is being
imported for the first time it reads the "Checking sheet" in the excel
file and prints if there is any <b>No</b>. 
</p>

<p>
If it is an edited questionnaire, it makes the following checks (in
the same order):
</p>

<ol class="org-ol">
<li>It checks that all the values being imported are valid.
</li>
<li>It checks that the region names exist in the database, and that
they are listed in the same order than in the original questionnaire.
</li>
<li>It checks that the parts are smaller than the total (this means
for example, the female figures are less than or equal to total figures).
</li>
<li>It checks that the region values add up to the country value.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Data extraction and comments</h2>
<div class="outline-text-2" id="text-4">
<p>
The <code>extract_data</code> method reads the values and enters them in the
database. It also writes the region names to the regions database if
an original questionnaire is being imported.
</p>

<p>
There are two different types of comments, the ones from excel that
every cell can have and the ones that are part of the questionnaire
and that are on the top of each table. The first ones we call them
cell comments and the second ones table comments. Cell comments can be
imported to the database with the  <code>extract_comments</code> method an table
comments with the <code>extract_table_comments</code> method.
</p>

<div class="org-src-container">

<pre class="src src-python">qobject.preprocessing()
qobject.extract_data()
qobject.extract_comments()
qobject.extract_table_comments()
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Exporting the data</h2>
<div class="outline-text-2" id="text-5">
<p>
In order to export the data from the database to an excel file, the
<code>xlsxwriter</code> modules needs to be used in combination with the function
<code>export_var</code>. As shown in the following example, first the excel
workbook needs to be created and then <code>export_var</code> needs to be called
for each desired sheet.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F92672;">import</span> xlsxwriter
<span style="color: #FD971F;">co_code</span> = qobject.country_code
<span style="color: #FD971F;">co_name</span> = qobject.country_name
<span style="color: #FD971F;">year</span> = qobject.emco_year

<span style="color: #FD971F;">filename</span> = <span style="color: #E6DB74;">"{0}_{1}.xlsx"</span>.<span style="color: #F92672;">format</span>(co_name, 2012)

<span style="color: #FD971F;">wb</span> = xlsxwriter.Workbook(filename)

export_var(<span style="color: #E6DB74;">'Administrative divisions'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
export_var(<span style="color: #E6DB74;">'Pupils'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
export_var(<span style="color: #E6DB74;">'Teachers ISCED 1'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
export_var(<span style="color: #E6DB74;">'Teachers ISCED 2'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
export_var(<span style="color: #E6DB74;">'Teachers ISCED 3'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
export_var(<span style="color: #E6DB74;">'Teachers ISCED 23'</span>, wb, co_code, year, var_type = <span style="color: #E6DB74;">"sheet"</span>)
wb.close()
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: August 10, 2015</p>
<p class="author">Author: Oscar Alberto Quijano Xacur and Mohamad Elmasri</p>
<p class="creator">Emacs 24.4.1 (Org mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
