#+TITLE: Regional Module Graphical User Interface (GUI) User Guide
#+AUTHOR:   Mohamad Elmasri
#+DATE: August 10, 2015
#+OPTIONS:   H:4 num:t toc:3 p:t ^:nil
#+STARTUP: nofold

#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="css/styles/readtheorg/css/readtheorg.css"/>
#+HTML_HEAD: <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
#+HTML_HEAD: <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="css/styles/lib/js/jquery.stickytableheaders.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="css/styles/readtheorg/js/readtheorg.js"></script>

#+CAPTION: Screen shot of RM_GUI.
#+NAME:   fig:RM_GUI
[[./img/RM_GUI.png]]

This document explains how to use the management system GUI of the Regional Module. There are four main frames in the GUI that could be seen in Figure [[fig:RM_GUI]].
    * [[General information][General information]]: general session and user information as
      the user-name and database location, log, ...
    * [[Importing questionnaire to the database][Importing questionnaire to the database]]: tools to
      import a single questionnaire of a folder of questionnaires.
    * [[Exporting data to Excel][Exporting data to Excel]]: tools to export and visualize the
      data that are already in the database.
    * [[Status frame and Log subfolder][Status]]: a panel that outputs updates on the carried procedures, including any errors.

#+begin_sidebar
In this guide you will learn to:
    + Import questionnaires.
    + Export and and view data for cleaning.
    + Move data between series.
    + And hopefully some Python.
#+end_sidebar
Each frame has a specific subsection below that explains in details how to use the available tools.

* General information
This frame holds information that are essential for all tools in other frames, and will be used all over this guide.

    * *User* prints the automatically retrieved user name from the windows login information. 
    * *Main working directory* is the path of the main folder where all the other mentioned subfolders are located.
    * *Database* shows the path to the physical database(~.db~
      file). In Figure [[fig:RM_GUI]] it is in the subfolder ~Database~ of
      main folder as indicated by ~/Database/Prod.db~. For example if the main directory is ~/Desktop/RMS~ then the database file is at ~/Desktop/RMS/Database/UISProd~.   
    * *Log folder* holds error and processing logs every time a user
      attempts to write, read or move data. It is also a subfolder of
      the main directory. See Section [[Processing report]] for more details.
    * *Output folder* is the default folder where exported Excel workbooks are save if no other folder is specified.
    * *Import backup folder* holds backups of every imported Excel
      workbook. A copy of the Excel workbook is saved with with time
      and date stamps attached to its name.

#+begin_note
 * Data in the [[General information][General information frame]] are only editable from the scripts, not from the GUI.
 * Only the *Export* folder is editable through the export panel.
#+end_note

* Importing questionnaire to the database
Two ways exist to importing questionnaires. 
    1) *Importing a single questionnaire* is done by clicking on the
       ~Browse..~ button that is adjacent to ~file~ label. Select a file and then click the adjacent ~Import~ button.
    2) *Importing a folder of questionnaires* is done by clicking on
       ~Browse..~ button that is adjacent to ~folder~ label. Select a folder and then click on the adjacent ~Import~ button.

In both cases, each file is first validated with pre-precessing checks
to make sure that it conforms with the coding scheme. Validation logs
will appear in the [[Status frame and Log subfolder][Status]] frame and also a report is written in the
~Log folder~.

For more details about the pre-processing report please refer to
[[Processing report]] section.

#+begin_note
    * Note that only files with ~.xlsx~ extensions are imported.
    * All imported files are copied to the ~Export~ subfolder with
      time and data stamps attached to their names to indicate the time of importing.
#+end_note

* Exporting data to Excel
** Choosing a country name, year and series
The ~Country~ drop-down list will only show names of countries with
data already in the database. This drop-down list has a live connection to the database, thus if one imports a questionnaire for a new country as shown in a [[Importing questionnaire to the database][previous section]], the country's name should appear in the drop-down list.

Once a country name is selected, the ~Year~ drop-down list shows years
with available questionnaire data for the selected country. 

The series drop-down list has three options:
    1. Reported (REP): where the original questionnaire is
       inserted,given that no person has changed or modified any of
       the data in this series. It is advised to only modify data in
       the Observed series.
    2. Observed (OBS): where the persons could modify and validate the
       data. 
    3. Estimated (EST): where the disseminated data set should be.

** Moving data between series
An original questionnaire is always imported to the Reported series, to move it the Observed or Estimated series, choose first the country and year, and then click on the button in the ~Move between databases~ frame.

~REP to OBS~ would move the data from Reported to Observed series.

~OBS to EST~ would move the data from the Observed to Estimated series.

** Exporting options

#+begin_important
This section is important because is contains many necessary details to understand how the whole GUI works.
#+end_important

There are three ways to export the data, sheet only, table only and
alphanumeric code only. Each way has its own down-down list.
    1. Sheet: a drop-down list of all exportable questionnaire sheet names. Once a sheet is selected click on the adjacent ~Export~ button to export it to a new Excel workbook. To export all available sheets select ~All~ from the drop-down list.
    2. Table: a drop-down list with all tables of the questionnaire. By selecting one and clicking on the adjacent ~Export~ button an new Excel workbook is created that holds the selected table.
    3. AC: a drop-down list with all alphanumeric codes (AC) that are in the questionnaire. By selecting one and clicking on the adjacent ~Export~ button a new Excel workbook is created that holds the data.

#+begin_note
The exported workbooks are by default saved to ~Export~ subfolder with
the naming convention ~County Name-Year-Exported Variable-Series.xlsx~. Users
can change where to save exported files by selecting a folder in the option
~Select output folder~ as seen in the ~Exporting data to Excel~ frame
in Figure [[fig:RM_GUI]]. 
#+end_note

Also there are two viewing modes, an ~Edit~ and a ~Read only~ mode. 
    1) ~Edit~ mode: allows users to edit the data, comments and
       inclusions in the Excel sheet and re-import them to the
       database as shown in [[Importing questionnaire to the database][Importing questionnaire to the database]]
       section. This works by preserving the table locations exactly
       where they are in the original questionnaire. Users will notice
       that created Excel workbook looks very similar to the original
       questionnaire. *DO NOT* move tables from their original
       location, change the sheet name, or delete any of the data in
       the configuration panel in the top left corner as seen in
       Figure [[fig:exportConfig]]. You are only allowed to modify cell
       figures, comments and inclusions. The configuration panel is
       necessary to re-import the data.
    2) ~Read only~ mode: facilitates the viewing of the data by
       shifting tables to the left part of the Excel worksheet to
       avoid unnecessary scrolling. However, the mode will not allow
       users to re-import the data back in the database, since the
       tables or alphanumeric codes are not in the exact location as
       they are in the original questionnaire.

#+CAPTION: Screen shot of the top left corner of an exported Excel sheet which shows the configuration panel.
#+NAME:   fig:exportConfig
[[./img/exportConfig.png]]

#+begin_note
The viewing mode is chosen by the software. It is set to ~Edit~ mode
if a sheet or the whole questionnaire is exported, otherwise it is set
to ~Read only~ mode. Users can know the mode by looking at the
configuration panel in any Excel sheet as seen in Figure [[fig:exportConfig]].
#+end_note

* Status frame and Log subfolder
The ~Status~ frame is a read-only text box that prints errors and
status of procedures. Some of the outputs are also recorded in the
~Log~ subfolder see the [[Processing report][next]] section.

* Processing report
A pre-processing report is created every time one attempts to import a
questionnaire. It includes all confirmations and errors and have the naming convention as ~RM-Country Name-Year-Series-Data-Type-Time-Date.txt~. Some the data included in the report is also printed in the [[Status frame and Log subfolder][Status]] frame and ~Log~ subfolder.

The idea of the pre-processing report is to list errors and data
problems exist before inserting the questionnaire. Only if all the
data checks pass the questionnaire is imported.

The pre-processing step validates the below conditions, all failed
conditions are printed to the [[Status frame and Log subfolder][Status]] frame to a log file
in the ~Log~ subfolder.
    1) If the import is in the original questionnaire format
       * all checks in the ~Checking sheet~ must be passed. 
    2) If the import is *not* in the original questionnaire format
       * worksheet must be in ~Edit~ mode
       * no data cell is empty
       * all cells must have proper coding, that is ~X~ for inclusion,
         ~m~ for missing, ~Z~ for inapplicable
       * all columns must sum to the national level total
       * all sub-category must sum to the total. For example, public
         and private data must sum to the total of public and private
       * all partial category data must be less than or equal to
         totals. For example, female data must be less than or equal
         to total of male and female
       * data in configuration panel must be correct, that is country
         name, code, year and no. of administrative divisions
       * tables and column numbers must be in the correct place

  
* A complete example 
** Importing the original questionnaire
To give an example consider importing a made-up questionnaire say for ~Laos~ for year ~2015~ that
is saved in a file ~Desktop/Example/LAOS-2015-Regional_Survey.xlsx~, as seen in
Figure [[fig:laosDesktop]]. First start the ~RM_GUI.py~ select the file
and click the adjacent ~Import~. The [[Status frame and Log subfolder][Status]] frame should show

#+CAPTION: Laos original questionnaire submission.
#+NAME:   fig:laosDesktop
[[./img/LAOS_desktop.png]]

#+begin_src
Importing C:/Users/myUser/Desktop/Example/LAOS-2015-Regional_Survey.xlsx
Date: 08/03/15
Questionnaire path: C:/Users/myUser/Desktop/Example/LAOS-2015-Regional_Survey.xlsx
All the checks passes. QUESTIONNAIRE CAN BE PROCESSED
Import successful...Done
#+end_src

This implies the import is successfully. In addition a backup file and a
log file are creates in:
 + backup file: ~RMS\Import\RM_Lao People's Democratic
   Republic_2015_15-08-08-21-54.xlsx~
 + log file: ~RMS\Log\Lao People's Democratic Republic_15-08-08-21-54.log~

** Moving to and exporting from the Observed series.
After a successful original import, one can move the data from
/Reported/ to /Observed/ series. Notice that Laos now appears in the ~Country~ drop-down
list. Select ~Laos~ and the corresponding year, then
click on ~REP to OBS~ button. The [[Status frame and Log subfolder][Status]] frame should show [[fig:laosREP2CLN][this]].

#+CAPTION: Laos data moved from REP to OBS.
#+NAME:   fig:laosREP2CLN
[[./img/LAOS_moveCLN.png]]

Now, let's export ~Teachers ISCED 2~ for cleaning. Select the country,
year and series from the drop-down lists and from the ~Sheet~
drop-down list select ~Teachers ISCED 2~ and before clicking on the
adjacent ~Export~ button, select the ~output folder~ to be your
~Desktop~. The [[Status frame and Log subfolder][Status]] frame will have the confirmation seen in box
[[src:export_clean]], and the Excel workbook should look like [[fig:excel_clean][this]]. Notice the configurations in the top left corner, where the mode is ~Edit~ and the series is ~OBS~. 

#+CAPTION: Status frame output
#+NAME:   src:export_clean
#+begin_src
Exporting Teachers ISCED 2 from OBS series for Lao People's Democratic Republic-2015....
File C:/Users/myUser/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx is created..
Done.
#+end_src   

#+CAPTION: Exported Laos data from observed series.
#+NAME:   fig:export_clean
[[./img/export_clean.png]]

** Cleaning and re-importing
As mentioned before as long as the configuration panel is left
untouched and all tables are not moved, one can go ahead and change
the data, inclusion codes and insert cell and table comments. For
example, assume for some reason Laos-2015 data we prefer to only
report the data under ~T.2.GPV.Pu~ in
col 2  and not to report ~T.2.GPV.Pu.F~ in column 3. We do this by
inclusion code.  Also we add a comment that the data
is aggregated by programme team. See Figure [[fig:laos_mod]] and compare it to Figure
[[fig:export_clean]].

#+CAPTION: Modified Laos data from observed series.
#+NAME:   fig:laos_mod
[[./img/laos_mod.png]]

*To import* follow similar step as in Section [[Importing questionnaire
 to the database]]. Start the ~RM_GUI~ select the modified file and import
 it. If successful the [[Status frame and Log subfolder][Status]] frame should show

#+begin_src
Importing C:/Users/myUser/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx
Import successful...Done
#+end_src

otherwise it would list validation errors such as.

#+begin_src
Pre-processing validation failed. Some errors exist see log file in:
Log
Importing C:/Users/myUser/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx
Column 14 in table Table 2.2 has improper values.
#+end_src

Since import is successful a backup file and log file are also creates
 + backup file: ~RMS\Import\RM_Lao People's Democratic Republic_2015_15-08-08-22-10.xlsx~
 + log file: ~RMS\Log\Lao People's Democratic Republic_15-08-08-22-10.log~

Now if you re-export the whole questionnaire, ~Teachers ISCED 2~
sheet, or only ~Table 2.1~ from the observed series, you should be
able to see the changes and comments made earlier.
