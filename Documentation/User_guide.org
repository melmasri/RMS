#+TITLE: Regional Module Graphical User Interface (GUI) User Guide
#+AUTHOR:   Mohamad Elmasri
#+OPTIONS: ':nil *:t -:t ::t <:t H:4 \n:nil ^:nil arch:headline
#+OPTIONS: author:t c:nil creator:comment d:(not "LOGBOOK") date:t
#+OPTIONS: e:t email:nil f:t inline:t num:t p:t pri:nil stat:t
#+OPTIONS: tags:t tasks:t tex:t timestamp:t toc:3 todo:t |:t
#+CREATOR: Emacs 24.4.1 (Org mode 8.2.10)
#+DESCRIPTION:
#+EXCLUDE_TAGS: noexport
#+KEYWORDS:
#+LANGUAGE: en
#+SELECT_TAGS: export
#+startup: content

#+SETUPFILE: css/theme-readtheorg-local.setup

#+CAPTION: Screen shot of RM_GUI.
#+NAME:   fig:RM_GUI
[[./img/RM_GUI.png]]

This document explains how to use the management system GUI of the Regional Module (RM). There are four main frames in the GUI that could be seen in Figure [[fig:RM_GUI]].
    * [[General information][General information]]: general session and user information as
      the user name and database location, main working directory, ..etc. 
    * [[Importing questionnaire to the database][Importing questionnaire to the database]]: tools to
      import or validate a single questionnaire.
    * [[Exporting data or indicators to Excel][Exporting data or indicators to Excel]]: tools to export and visualize the
      raw data or indicators that are already in the database.
    * *Status*: a panel that outputs updates on the carried procedures, including any errors. Shown in the bottom of the interface.

#+begin_sidebar
In this guide you will learn to:
    + Import questionnaires.
    + Export and and view data for cleaning.
    + Move data between series.
    + Calculate and view indicators.
    + And hopefully some Python and SQL too.
#+end_sidebar
Each frame, excluding the Status panel, has a specific subsection below that explains in details how to use the available tools.

* General information
This frame holds information that are essential for all tools in other frames, and will be used all over this guide.

    * *User* prints the automatically retrieved user name from the
      windows login information. This user name is used to track user
      changes to the data as will be later explained.
    * *Main working directory* is the path of the main folder where
      all the other mentioned sub-folders are located. Basically, it is
      the folder that contains all the software, from code to documentation.
    * *Database* shows the path to the physical database (~.db~ file). In Figure [[fig:RM_GUI]], it is in the sub-folder ~Database~ of
      the main folder as indicated by ~/Database/Prod.db~. For example if
      the main directory is ~/Desktop/RMS~ then the database file is
      at ~/Desktop/RMS/Database/Prod.db~.   
    * *Log folder* holds validation and data reports every time a user
      attempts validate, check only or insert the data. It is also a sub-folder of
      the main directory. See Sections [[Validation report]]  and [[Data report]] for more details.
    * *Output folder* is the default folder where exported Excel
      workbooks are saved if no other folder is specified. /Note that you can specify another output folder, see note in [[Exporting data options][Exporting data options]]./
    * *Import backup folder* holds backups of every inserted Excel
      workbook. A copy of the Excel workbook is saved with time
      and date stamps attached to its name.

#+begin_note
 * Data in the [[General information][General information frame]] are only editable from the scripts, not from the GUI.
 * Only the *Output folder* folder is editable through the export panel, see note in [[Exporting data options][Exporting data options]].
#+end_note

* Importing questionnaire to the database
To Insert a questionnaire to the database, follow these steps:
    1. Click on the ~Browse..~ button that is adjacent to ~file~
       label and select a file.
    2. Validate the file by clicking on ~Validate~ button, since there
       are specific pre-processing checks to make sure that it
       conforms with the coding scheme. If the checks are passed, the
       Status panel will indicate with a note on the lines of 
       #+begin_src
       Validation successful, see report in:
       Log/Lao People's Democratic Republic_16-01-22-11-33_validation.txt 
       #+end_src
       otherwise on the lines of
       #+begin_src
       Pre-processing validation failed. Some errors exist see log file in:
       Log/Lao People's Democratic Republic_16-01-22-11-35_validation.txt
       #+end_src
       In both cases a validation report is saved in the ~Log folder~, and
       should automatically open if the box ~Open validation report~ is ticked.
    3. If validation passed, insert the questionnaire by clicking on
       ~Insert~. The file is inserted to the database and a ~csv~ data report is
       generated and saved in the ~Log folder~, and also should
       automatically open if the box named ~Open data report~ is
       ticked. A note on the lines of 
        #+begin_src
           INSERTION STEP

        Inserting C:/Users/Mohamad/Documents/GitHub/RMS/Import/RM_Lao People's Democratic Republic_2015_15-11-19-23-46.xlsx
        Checking that region values add to the country value...Test passed.
        Checking that parts are less than the totals...Test passed.
        Checking sums of columns...
        ----------Questionnaire Insertion finished.----------.
        
        Data report written to: 
        Log/Lao People's Democratic Republic_16-01-22-11-40_data_report.csv
        #+end_src
       will appear in the Status panel.

The steps above are simplified. For more details about the
pre-processing checks and data report please refer to Sections [[Validation report]] and [[Data report]].

#+begin_note
    * Note that only files with ~.xlsx~ extensions are inserted.
    * A copy of any inserted file is saved to the ~Export~ sub-folder with
      time and data stamps attached to their names to indicate the
      time of importing.
    * All validation files and data reports are saved to the ~Log folder~,
      while some information is shown in the Status panel.
#+end_note

*About the checkboxes:*
    * *Import to REP* is a security checkbox that stops the user from
      inserting to the reported series (REP) by mistake. It is
      unticked by default, and works as follows, if the user attempts
      to insert some data to the reported series, even if the file
      validates, the user is not allowed unless this checkbox is
      ticked. Only under one exception is it allowed, if the inserted   
      file is an original questionnaire, this become more clear in
      [[Exporting data options][Exporting data options]].
    * *Open validation report* is a checkbox that is ticked by default to
      automatically open the validation report resulting from the validation
      step. Feel free to untick it as all the validation reports are saved in
      the ~Log folder~.
    * *Open data report* is a checkbox that is ticked by default to
      automatically open the date report resulting after inserting a
      questionnaire. Feel free to untick it since all data reports are
      saved to the ~Log folder~.

Finally, the button *~Check only~* allows the user to produce a data
report without validating nor inserting the data. The objective is to
streamline the cleaning process before finally inserting the data. 

* Exporting data or indicators to Excel
** Choosing a country name, year and series
The ~Country~ drop-down list will only show names of countries with
data already in the database. This drop-down list has a live connection to the database, thus if one inserts a questionnaire for a new country, as shown in a [[Importing questionnaire to the database][Importing questionnaire to the database]], the country's name should appear in the drop-down list directly.

Once a country name is selected, the ~Year~ drop-down list shows years
with available questionnaire data for the selected country. 

The series drop-down list has three options:
    1. Reported (REP): where the original questionnaire is
       inserted, given that no person has changed or modified any of
       the data in this series. It is advised to only modify data in
       the Observed series, thus the checkbox ~Import to REP~ is created.
    2. Observed (OBS): where the user is advised to modify and validate the
       data. 
    3. Estimated (EST): where the disseminated data set should be,
       *since the indicators are calculated from this series only*.

** Moving data between series
An original questionnaire is always inserted to the /Reported/ series, to move it the /Observed/ or /Estimated/ series, choose first the country and then year, and then click on the buttons in the ~Move between databases~ frame.

    * ~REP to OBS~ would move the data from /Reported/ to /Observed/ series.
    * ~OBS to EST~ would move the data from the /Observed/ to /Estimated/ series.

** Exporting data options

#+begin_important
This section is important because is contains many necessary details to understand how the whole GUI works.
#+end_important

There are three ways to export data, sheet only, table only and
alphanumeric code (AC) only. Each way has its own drop-down list.
    + Sheet :: A drop-down list of all exportable questionnaire sheet names. Once a sheet is selected click on the adjacent ~Export~ button to export it to a new Excel workbook. To export all available sheets select ~All~ from the drop-down list.
    + Table :: A drop-down list with all tables of the questionnaire. By selecting one and clicking on the adjacent ~Export~ button a new Excel workbook is created that holds the selected table.
    + AC :: A drop-down list with all alphanumeric codes (AC) that are in the questionnaire. By selecting one and clicking on the adjacent ~Export~ button a new Excel workbook is created that holds the data.

#+begin_note
    + The exported workbooks are by default saved to ~Export~ sub-folder of the main directory, with the naming convention ~County Name-Year-Exported Variable-Series.xlsx~. 
    + Users can change where to save exported files by selecting a folder in the option ~Select output folder~ as seen in the ~Exporting data to Excel~ frame in Figure [[fig:RM_GUI]]. If the user selects another output folder than ~Export~, only exported questionnaire data is placed there. Validation and data reports will still be saved to the log sub-folder ~Log~.
#+end_note  

** Viewing modes
When any data is exported, they are exported based on two viewing modes, an ~Edit~ and a ~Read only~ mode. 
    1) ~Edit~ mode: allows users to edit the data, comments and
       inclusions in the Excel sheet and reinsert them to the
       database as shown in [[Importing questionnaire to the database][Importing questionnaire to the database]]
       section. This works by preserving the table locations exactly
       where they are in the original questionnaire. Users will notice
       that created Excel workbooks look very similar to the original
       questionnaire. *DO NOT* move tables from their original
       locations, change the sheet names, or delete any of the data in
       the *configuration panel*; in the top left corner as seen in
       Figure [[fig:exportConfig]]. You are only allowed to modify cell
       figures, comments and inclusions. The configuration panel is
       necessary to reinsert the data, without it the validation would fail and missing around with it might harm the functionality of the software.
    2) ~Read only~ mode: facilitates the viewing of the data by
       shifting tables to the left part of the Excel worksheet to
       avoid unnecessary scrolling. However, the mode will *not allow users to reinsert the data* back in the database, since the
       tables or alphanumeric codes are not in the exact location as
       they are in the original questionnaire. If users attempt to
       import a ~Read only~ mode file, the validation step will fail,
       hence not allowed to import.

#+CAPTION: Screen shot of the top left corner of an exported Excel sheet which shows the configuration panel.
#+NAME:   fig:exportConfig
[[./img/exportConfig.png]]

#+begin_important
    *  The viewing mode is chosen by the software. It is set to ~Edit~
       mode if a sheet or the whole questionnaire is exported,
       otherwise it is set to ~Read only~ mode. Users can know the
       mode by looking at the configuration panel in any Excel sheet
       as seen in Figure [[fig:exportConfig]].
    *  Users are only allowed to select from the drop-down list, or
       type manually the names of sheets, tables or ACs. If the users types anything else, the
       software will reject it. 
#+end_important

** Exporting and calculating indicators

Before exporting any indicators, we need to calculate them. For the
selected country and year the ~Calculate~ button in the indicator
sub-frame will calculate all indicators from the data in the
/Estimated/ series. Therefore, users must make sure that data exist in
the /Estimated/ series. Once all indicators are calculated, users can
extract them using one of the following methods
    + Direct Extraction :: By selecting from the drop-down list or
       typing the indicator name (IND_ID) and clicking on the adjacent ~Extract~
       button. To extract all indicators select or type ~All~.
    + Wildcard :: Since the huge list of indicators, users can
       extract groups of indicators using name patterns, where ~%~
       substitutes for zero or more characters and ~_~ substitutes for
       a single character. For example,
      * to extract all indicators for teachers of ISCED 1 in the
        public sector you can type ~%T.1.Pu%~, since all requested
        indicators have the pattern ~T.1.Pu~ in their name.
      * to extract all the percentage of teachers with ISCED 2 or
        less qualification in all ISCED levels, type ~EA2m%~, since
        all of them start with the pattern ~EA2m~. If the interest is
        in the public sector only, type ~EA2m%.Pu~.
      * to extract the percentage of female teachers in ISCED levels 1, 2, and 3,
        but not 2 and 3, type ~FT._~, since all have the pattern
        ~FT.~ in their name and =_= substitutes for a single character.
Note that wildcards are only applicable to indicator extraction, not
raw data.


#+begin_note
    * Similar to the extraction of raw data, indicators are extracted
      for the selected country and year, for all administrative
      divisions. Thus even if you select a single indicator to
      extract, the result is a table of one column and a number of
      rows corresponding to the number of administrative division plus
      the national level. 
    * Some indicators, for example the max and min of an indicator, is
      only calculated for the national level, nonetheless, the
      extraction would result in a table of 1 column and all the
      administrative division cells are empty, while the national level
      holds the indicator figure.
    * If indicators are incalculable because of missing data or
      inclusions, the figure will be replaces by resulting magnitude code in the respective cell. *If the cell is empty, either the
      indicator is a national level indicator or the /Estimated/ series is empty.*
    * Indicators are always sorted alphabetically.
    * Exported indicator file follow the naming convention ~County Name-Year-Indic-indicator name.xlsx~, when the use of wildcards, =%= is replaced with =xx=.
#+end_note  

For the current version of the software, these are the list of calculated indicators:
    * Percentage of female teachers
    * Percentage of newly recruited teachers
    * Pupils teachers ratio
    * Percentage of trained teachers
    * Percentage of private teachers
    * Percentage of non-permanent teachers
    * Attrition rate
    * Mean age
    * Mean years of experience
    * Highest level of educational attainment
    * Percentage of teachers by years of experience
    * Percentage of teachers by age
    * Dissimilarity

For more details about the computational methods refer to <<refInd>>.

* Validation report
A validation report is created and saved in the ~Log~ sub-folder
every time the user attempts to insert a questionnaire by clicking on
the ~Validate~ button. It includes all confirmations and errors and
have the naming convention as ~RM-Country
Name-Year-Series-Data-Type-Time-Date.txt~. 

The idea of the validation is to list critical errors with
the selected file. Only if all the validation checks pass the
questionnaire is then allowed to be inserted.

The validation check the below conditions, all failed
conditions are saved and also printed to the Status panel:
    1) If the insert is in the original questionnaire format
       * ADM label, i.e., Province, district etc, is filled.
       * number of ADM is a positive integer.
       * the ADM names are filled.
       * the correct number of sheets are available with correct
         original names.
       * reference year is filled and an integer, from cell ~M14~ in
         "Policy information" sheet.
       * Any "No" in the "checking sheet" is copied to the validation report.
    2) If the insert is *not* in the original questionnaire format
       * worksheet must be in ~Edit~ mode.
       * configuration panel is properly filled.
         * no missing information.
         * labels of configuration are in the proper order of ~[Country, CO_CODE, Year, Data, No.ADM, Series,Mode]~.
         * mode defined as "Edit".
         * year is an integer bigger than zero.
         * series is one of the following ~[OBS,REP,EST]~.
         * country code matches the one taken from the database using the provided country name.
         * number of ADM is a positive integer. Note this variable is taken from the configuration panel, thus *DO NOT change it.*
    3) General checks: 
       * check that all data values are either a number, inclusion (X), Z, a, n, or m. Otherwise, validation fails and error is printed.

* Data report
  At this step if the validation checks have passed, once the user
  clicks on the ~Insert~ button, a data report is created and saved in
  the ~Log~ folder. If the checkbox ~Open data report~ is ticked, the
  report will automatically open. Also users can invoke the creation
  of a data report without validating or inserting the file, by
  clicking on the ~Check only~ button. 

  The data report check the following and lists any issues: 
  1) If the insertion is in the original questionnaire format
     * if ADM names exists in database they must equal the ones in
      the questionnaire, otherwise prints an error. This mean you
      can only change ADM names after they have been created by
      accessing the database directly, and if you try to reinsert the original questionnaire with reordered or changed region names, it will fail.
  2) General
     * all columns must sum to the national level total
     * all sub-category must sum to the total. For example, public
       and private data must sum to the total.
     * all partial category data must be less than or equal to
       totals. For example, female data must be less than or equal
       to total.

Note, for all the cells that have missing data (m), inclusion (x), or inapplicable (z), the inequality or sums tests are ignored.
     
* Audit trail
To keep track of changes to individual data and indicators, including figures, qualifiers, inclusion codes, and magnitudes, we have implemented an audit functionality in the backend (SQL), that records any changes to the data. This doesn't include data comments or table comments. We call this functionality *Audit trail*. Note that Audit trail tables are not accessible from the software interface (GUI), rather they function in the backend and only accessible by directly accessing the SQL database. 

There are two main tables that keep track of changes, one for raw (meter) data called =METER_AUDIT_TRAIL=, and the other for indicators called =INDICATOR_AUDIT_TRAIL=. Their structure is very similar and could be combined in one table, nevertheless, for more clarity we separated the indicators from raw data. 

In essence, every time there is a change in a data, both the old and new information is recorded with a timestamp and user name. The following two subsections discuss in more details how changes are recorded and how to understand and read these SQL tables.

** Data audit trail
   =METER_AUDIT_TRAIL= is the SQL table that records changes in raw data and metadata. Basically, any time there is a change in a raw figure or its metadata, which includes magnitudes (inclusion, missing,..) and qualifiers, both the new and old figures and metadata are recorded with the change timestamp and the user name. This change happens in the cleaning process, when the user attempts to modify data directly in Excel and reinserts it into SQL. Thus every time an =Edit= mode excel file is validated and reinserted, the data is compared to what is in the SQL database, and any changes are recorded. 

The following is the schema of the SQL table, where 
    * =MC_ID= is the numeric reference of the data and corresponds to an AC.
    * =CO_CODE= is the country code.
    * =ADM_CODE= is the administrative divisions code.
    * =MC_YEAR= is the data year.
    * =EM_FIG= is the actual data figure.
    * =MQ_ID= is the data qualifier.
    * =MG_ID= is the data magnitude.
    * =SYS_DATA= is the internal local time to when the change has happened.
#+begin_src sql
CREATE TABLE METER_AUDIT_TRAIL(
	Audit_ID Integer , -- Based on ROWID definition in SQLite, this should do the same job as auto-increment
	MC_ID decimal(6, 0) NOT NULL, --numeric reference of the data
    CO_CODE decimal(6, 0) NOT NULL, -- country code
    ADM_CODE INT NOT NULL, -- Administrative Division code.
	MC_YEAR decimal(4, 0) NOT NULL, -- data year
	EM_FIG_NEW varchar(4000) NULL, -- new figure
	EM_FIG_OLD varchar(4000) NULL,  -- old figure
	MQ_ID_NEW char(1) NULL, -- new qualifier
	MQ_ID_OLD char(1) NULL, -- old qualifier
	MG_ID_NEW char(1) NULL, -- new magnitude
	MG_ID_OLD char(1) NULL, -- old magnitude
	TYPE_MOD char(1) NULL, 
	USER_NAME varchar(20) NOT NULL, -- user name
	SYS_DATE datetime DEFAULT (datetime('now','localtime')), --local timestamp
	SERIES varchar(10) NOT NULL, -- data series
	SURVEY_ID char(2) NULL, --- Regional model default is set to 'RM'
    PRIMARY KEY (Audit_ID ASC));
#+end_src

To read from the table, using ~sqlite3~ connect to ~Prod.db~ file or any other database file you are using and follow standard SQL extraction syntax as
#+begin_src sql
SELECT * from METER_AUDIT_TRAIL LIMIT 5;
#+end_src
to see the first 5 rows of the table, and 
#+begin_src sql
SELECT a.* from METER_AUDIT_TRAIL AS a
LEFT JOIN EDU_METER_AID AS b ON a.MC_ID = b.EMC_ID
WHERE b.AC ='NT.1' AND a.CO_CODE = 4180 AND a.MC_YEAR = 2014;
#+end_src
for all the changes that happened to =NT.1=, newly recruited teachers in ISCED 1, initial education, for country with code 4180 for data year 2014. Using the ~EDU_METER_AID~ facilitates the use of AC directly rather than the numeric representation (~MC_ID~).

** Indicator audit trail
   =INDICATOR_AUDIT_TRAIL= is the SQL table that records changes in indicators and their metadata. Any time there is a change in the indicator or its metadata, which includes magnitudes (inclusion, missing,..) and qualifiers, both the new and old figures and metadata are recorded with change timestamp and the user name. This change happens when the user changes raw data and recalculates indicators by clicking on ~Calculate~ button in the indicator frame. Contrary to the data audit trail, users cannot manually change indicators and reinserts them, this functionality is not supported by the software.

The following is the schema of the SQL table, where 
    * =IND_ID= is the alphanumeric name of the indicator.
    * =CO_CODE= is the country code.
    * =ADM_CODE= is the administrative divisions code.
    * =IND_YEAR= is the indicator data year.
    * =FIG= is the actual indicator figure.
    * =QUAL= is the indicator qualifier.
    * =MAGN= is the indicator magnitude.
    * =SYS_DATA= is the internal local time to when the change has happened.
    * =SERIES= is always set to =EST= since indicators are only calculated from estimated series.

#+begin_src sql
REATE TABLE INDICATOR_AUDIT_TRAIL
CREATE TABLE INDICATOR_AUDIT_TRAIL(
	Audit_ID Integer , -- Based on ROWID definition in SQLite, this should do the same job as auto-increment
	IND_ID varchar(50) NOT NULL, -- indicator ID
    CO_CODE decimal(6, 0) NOT NULL, -- country code
    ADM_CODE INT NOT NULL, -- Administrative Division code.
	IND_YEAR decimal(4, 0) NOT NULL, -- indicator data year
	FIG_NEW varchar(4000) NULL, -- new figure
	FIG_OLD varchar(4000) NULL, -- old figure
	QUAL_NEW char(1) NULL,  -- new qualifier
	QUAL_OLD char(1) NULL,  -- old qualifier
	MAGN_NEW char(1) NULL,  -- new magnitude
	MAGN_OLD char(1) NULL,  -- old magnitude
	USER_NAME varchar(20) NOT NULL, 
	SYS_DATE datetime DEFAULT (datetime('now','localtime')), -- local change time
	SERIES varchar(10) NOT NULL, -- series is always EST
    PRIMARY KEY (Audit_ID ASC));
#+end_src  

To read from the table, using ~sqlite3~ connect to ~Prod.db~ file or any other database file you are using and follow standard SQL extraction syntax as
#+begin_src sql
SELECT * from INDICATOR_AUDIT_TRAIL LIMIT 5;
#+end_src
to see the first 5 rows of the table, and 
#+begin_src sql
SELECT * from INDICATOR_AUDIT_TRAIL
WHERE IND_ID ='FTP.1' AND CO_CODE = 4180 AND IND_YEAR = 2014;
#+end_src
for all the changes that happened to =FTP.1=, percentage of female teachers in ISCED 1, for country with code 4180 for data year 2014. Here we didn't need an  ~EDU_METER_AID~ table sine indicators are referenced directly by their alphanumeric code, which do not have an equivalent numerical representation like in raw data.
  
* A complete example 
** Importing the original questionnaire
To give an example consider importing a made-up questionnaire say for Laos for year 2015 that
is saved in a file ~Desktop/Example/LAOS-2015-Regional_Survey.xlsx~, as seen in
Figure [[fig:laosDesktop]]. First start the ~RM_GUI.py~ select the file
and click the adjacent ~Validate~, the Status panel frame now shows:
 
#+CAPTION: Laos original questionnaire submission.
#+NAME:   fig:laosDesktop
[[./img/LAOS_desktop.png]]

#+begin_src
----------Date: January 22, 2016----------
VALIDATION STEP

Original questionnaire submited with path:
C:/Users/Mohamad/Desktop/Example/LAOS-2015-Regional_Survey.xlsx

Number of administrative divisions: 5.0
ADM1 name provided: District
Administrative divisions:
                  myDistrict 1
                  myDistrict 2
                  myDistrict 3
                  myDistrict 4
                  myDistrict 5

Reference year: 2015
Country name is filled: Lao People's Democratic Republic
The correct number of sheets(11)has been submited.
Warning: The questionnaire contains missing values.

----------Questionnaire Validation finished.----------.

Validation successful, see report in:
Log/Lao People's Democratic Republic_16-01-22-13-32_validation.txt
#+end_src

and since the checkbox ~Open validation report~ is ticked a validation report
should open. To insert now click on ~Insert~, and the Status panel should show:

#+begin_src
INSERTION STEP

Inserting C:/Users/Mohamad/Desktop/Example/LAOS-2015-Regional_Survey.xlsx
Checking that region values add to the country value...Test passed.
Checking that parts are less than the totals...Test passed.
Checking sums of columns...
----------Questionnaire Insertion finished.----------.

Data report written to: 
 Log/Lao People's Democratic Republic_16-01-22-13-35_data_report.csv
#+end_src

In addition since the checkbox ~Open data report~ is ticked, the data
report should open up. For this example, the data report looks like [[fig:laosDataReport]]

#+CAPTION: Laos data report after insertion
#+NAME:   fig:laosDataReport
[[./img/data_report.png]]

This implies the import is successfully, and these are the created
files:
 + backup file: ~RMS\Import\RM_Lao People's Democratic Republic_2015_16-01-22-13-38.xlsx~
 + validation file: ~RMS\Log\Lao People's Democratic Republic_16-01-22-13-38_validation.txt~
 + data report: ~RMS\Log\Lao People's Democratic
   Republic_16-01-22-13-38_data_report.csv~

** Moving to and exporting from the Observed series.
After a successful original import, one can move the data from
/Reported/ to /Observed/ series. Notice that Laos now appears in the ~Country~ drop-down
list. Select ~Laos~ and the corresponding year, then
click on ~REP to OBS~ button. The Status panel should show 

#+begin_src
Moving data for 4180-2015
Moved METER, INCLU and FTN tables from REP to OBS
Moved COMMENT_TABLE table from REP to OBS
Done.
#+end_src


Now, let's export ~Teachers ISCED 2~ for cleaning. Select the country,
year and series from the drop-down lists and from the ~Sheet~
drop-down list select ~Teachers ISCED 2~ and before clicking on the
adjacent ~Export~ button, select the ~output folder~ to be your
~Desktop~. The Status panel will have the confirmation seen in box
[[src:export_clean]], and the Excel workbook should look like [[fig:excel_clean][this]]. Notice
the configurations panel in the top left corner, where the mode is ~Edit~ and the series is ~OBS~. 

#+CAPTION: Status frame output
#+NAME:   src:export_clean
#+begin_src
Exporting Teachers ISCED 2 from OBS series for Lao People's Democratic Republic-2015....
File C:/Users/myUser/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx is created..
Done.
#+end_src   

#+CAPTION: Exported Laos data from observed series.
#+NAME:   fig:export_clean
[[./img/export_clean.png]]

** Cleaning and reinserting
As mentioned before as long as the configuration panel is left
untouched and all tables are not moved, one can go ahead and change
the data, inclusion codes and insert cell and table comments. For
example, assume for some reason Laos-2015 data we prefer to only
report the data under ~T.2.GPV.Pu~ in
col 3  and not to report ~T.2.GPV.Pu.F~ in column 4. We do this by
inclusion code.  Also we add a comment that the data
is aggregated by programme team. Moreover, we add a table comment in
cell H11, saying that some data is not trusted. See Figure [[fig:laos_mod]] and compare it to Figure
[[fig:export_clean]].

#+CAPTION: Modified Laos data from observed series.
#+NAME:   fig:laos_mod
[[./img/laos_mod.png]]

*To validate and insert* follow similar step as in Section [[Importing questionnaire
 to the database]]. Start the ~RM_GUI~ select the modified file,
 validate and insert it. If successful the Status panel should show

#+begin_src
----------Date: January 22, 2016----------
VALIDATION STEP

Edited questionnaire submited with path:
C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx

Number of administrative divisions: 5.0
Configuration section of edited questionnaire is properly filled
Warning: The questionnaire contains missing values.

----------Questionnaire Validation finished.----------.

Validation successful, see report in:
Log/Lao People's Democratic Republic_16-01-22-21-23_validation.txt
----------Date: January 22, 2016----------
INSERTION STEP

Inserting C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx
Checking that region values add to the country value...Test passed.
Checking that parts are less than the totals...Test passed.
Checking sums of columns...Test passed.
----------Questionnaire Insertion finished.----------.

Data report written to: 
 Log/Lao People's Democratic Republic_16-01-22-21-23_data_report.csv
#+end_src

otherwise it would list validation errors such as.

#+begin_src
----------Date: January 22, 2016----------
VALIDATION STEP

Edited questionnaire submited with path:
C:/Users/Mohamad/Desktop/Example/Lao People's Democratic Republic_2015_Teachers ISCED 2_OBS.xlsx

Number of administrative divisions: 5.0
Configuration section of edited questionnaire is properly filled
Error: Column 3 in table Table 2.1 has improper values.
Warning: The questionnaire contains missing values.

----------Questionnaire Validation finished.----------.

Pre-processing validation failed. Some errors exist see log file in:
Log/Lao People's Democratic Republic_16-01-22-21-25_validation.txt
#+end_src

Since inserting is successful the following files are created
 * backup file: ~RMS\Import\RM_Lao People's Democratic Republic_2015_16-01-22-21-23.xlsx~
 * log file: ~RMS\Log\Lao People's Democratic Republic_16-01-22-21-23_validation.txt~
 * data report: ~RMS\Log\Lao People's Democratic Republic_16-01-22-21-23_data_report.csv~

Now if you re-export the whole questionnaire, ~Teachers ISCED 2~
sheet, or only ~Table 2.1~ from the observed series, you should be
able to see the changes and comments made earlier.

** Calculating indicators


To calculate indicators, first select the country name and year, then select the estimated series. If the data is not yet in the ~EST~ series, please move it by clicking on the button ~OBS to EST~, maybe also ~REP to OBS~ if you haven't moved it yet to ~OBS~ series. Then click on the button ~Calculate~.  In around 30 seconds to a minutes, the Status panel should indicated that the process is successful.

#+begin_src
Successful..all indicators are calculated.
#+end_src

Now using the wildcards lets extract the percentage of teachers with attainment of ISCED 5 and higher for all public institutions, that is we type ~EA5pPT.%Pu~ and click on ~Extract~. The file is now saved under the name ~Lao People's Democratic Republic_2015_INDIC_EA5pPT.xxPu.xlsx~ in the ~Export~ folder if no other folder is specified. This is indicated in the Status panel as seen below. 

#+begin_src
Extracting EA5pPT.%Pu for Lao People's Democratic Republic-2015....
File /home/mo/Desktop/Lao People's Democratic Republic_2015_INDIC_EA5pPT.xxPu.xlsx is created..
Done.
#+end_src

The file should also automatically open up and in this example, looks like this.

#+CAPTION: Screen shot of EA5pPT indicator
[[./img/export_indicator.png]]


* TODO 
  + [ ] Add the indicators details and link it here [[refInd]]
  + [X] complete Data report section, mainly what happens for less
    than check and region total when data has m ,n ,a,z, or x.
  + [ ] Replace the GUI screenshoot, Figure 1.


